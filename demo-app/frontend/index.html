<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ–º–æ: –ò–¥–µ–∞–ª—å–Ω—ã–π –°—Ç–µ–∫</title>

    <!-- Alpine.js CDN (15 KB –º–∏–Ω–∏–º–∞–ª–∏–∑–º!) -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .tech-stack {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .badge {
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge.green { background: #10b981; }
        .badge.blue { background: #3b82f6; }
        .badge.purple { background: #8b5cf6; }
        .badge.orange { background: #f59e0b; }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            background: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .tab.active {
            background: #667eea;
            color: white;
        }

        .content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: #f9fafb;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }

        .card:hover {
            border-color: #667eea;
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.2);
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .card p {
            color: #6b7280;
            line-height: 1.6;
            margin: 5px 0;
        }

        .stat {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #6b7280;
        }

        .error {
            background: #fee2e2;
            color: #991b1b;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .btn {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #5568d3;
            transform: translateY(-2px);
        }

        .service-status {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .service-status.healthy {
            background: #10b981;
            box-shadow: 0 0 8px #10b981;
        }

        .service-status.error {
            background: #ef4444;
        }

        .info-box {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container" x-data="app()" x-init="init()">
        <!-- Header -->
        <div class="header">
            <h1>üöÄ –î–µ–º–æ: –ò–¥–µ–∞–ª—å–Ω—ã–π –°—Ç–µ–∫</h1>
            <p style="color: #6b7280; margin: 10px 0;">
                –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã + Polyglot Persistence + Alpine.js Frontend
            </p>
            <div class="tech-stack">
                <span class="badge green">Flask –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã</span>
                <span class="badge blue">MongoDB + PostgreSQL</span>
                <span class="badge purple">Redis –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ</span>
                <span class="badge orange">Nginx API Gateway</span>
                <span class="badge">Alpine.js (15 KB!)</span>
                <span class="badge">Docker + Alpine Linux</span>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab" :class="{'active': currentTab === 'overview'}" @click="currentTab = 'overview'">
                üìä –û–±–∑–æ—Ä
            </button>
            <button class="tab" :class="{'active': currentTab === 'users'}" @click="currentTab = 'users'">
                üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
            </button>
            <button class="tab" :class="{'active': currentTab === 'products'}" @click="currentTab = 'products'">
                üì¶ –¢–æ–≤–∞—Ä—ã
            </button>
            <button class="tab" :class="{'active': currentTab === 'orders'}" @click="currentTab = 'orders'">
                üõí –ó–∞–∫–∞–∑—ã
            </button>
        </div>

        <!-- Content -->
        <div class="content">
            <!-- Overview Tab -->
            <div x-show="currentTab === 'overview'">
                <h2>–°—Ç–∞—Ç—É—Å –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤</h2>

                <div class="grid" style="margin-top: 20px;">
                    <div class="card">
                        <h3>
                            <span class="service-status" :class="health.users ? 'healthy' : 'error'"></span>
                            User Service
                        </h3>
                        <p><strong>–ë–∞–∑–∞:</strong> MongoDB</p>
                        <p><strong>–ö—ç—à:</strong> Redis</p>
                        <p class="stat" x-text="stats.users?.total_users || 0"></p>
                        <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</p>
                    </div>

                    <div class="card">
                        <h3>
                            <span class="service-status" :class="health.products ? 'healthy' : 'error'"></span>
                            Product Service
                        </h3>
                        <p><strong>–ë–∞–∑–∞:</strong> MongoDB</p>
                        <p><strong>–ì–∏–±–∫–∞—è —Å—Ö–µ–º–∞:</strong> –†–∞–∑–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã</p>
                        <p class="stat" x-text="stats.products?.total_products || 0"></p>
                        <p>–¢–æ–≤–∞—Ä–æ–≤</p>
                    </div>

                    <div class="card">
                        <h3>
                            <span class="service-status" :class="health.orders ? 'healthy' : 'error'"></span>
                            Order Service
                        </h3>
                        <p><strong>–ë–∞–∑–∞:</strong> PostgreSQL</p>
                        <p><strong>ACID:</strong> –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</p>
                        <p class="stat" x-text="stats.orders?.total_orders || 0"></p>
                        <p>–ó–∞–∫–∞–∑–æ–≤</p>
                    </div>
                </div>

                <div class="info-box" style="margin-top: 30px;">
                    <h3>üí° –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞</h3>
                    <p><strong>Frontend:</strong> Alpine.js (15 KB) ‚Äî –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫</p>
                    <p><strong>API Gateway:</strong> Nginx ‚Äî –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –ø—Ä–æ–∫—Å–∏</p>
                    <p><strong>–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã:</strong> Flask (Python) ‚Äî –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã</p>
                    <p><strong>Polyglot Persistence:</strong></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>MongoDB ‚Äî –≥–∏–±–∫–∞—è —Å—Ö–µ–º–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ç–æ–≤–∞—Ä–æ–≤</li>
                        <li>PostgreSQL ‚Äî ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∑–∞–∫–∞–∑–æ–≤</li>
                        <li>Redis ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–µ—Å—Å–∏–∏</li>
                    </ul>
                    <p style="margin-top: 10px;"><strong>–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:</strong> Docker —Å Alpine Linux (–º–∏–Ω–∏–º–∞–ª–∏–∑–º)</p>
                </div>
            </div>

            <!-- Users Tab -->
            <div x-show="currentTab === 'users'">
                <h2>üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (MongoDB)</h2>
                <p style="color: #6b7280; margin: 10px 0;">
                    –°–µ—Ä–≤–∏—Å: User Service | –ë–∞–∑–∞: MongoDB | –ö—ç—à: Redis
                </p>

                <div x-show="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

                <div class="grid" x-show="!loading">
                    <template x-for="user in users" :key="user._id">
                        <div class="card">
                            <h3 x-text="user.name"></h3>
                            <p><strong>Email:</strong> <span x-text="user.email"></span></p>
                            <p><strong>–†–æ–ª—å:</strong> <span x-text="user.role"></span></p>
                            <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> <span x-text="user.phone"></span></p>
                            <p style="margin-top: 10px; font-size: 12px; color: #9ca3af;">
                                ID: <span x-text="user._id"></span>
                            </p>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Products Tab -->
            <div x-show="currentTab === 'products'">
                <h2>üì¶ –¢–æ–≤–∞—Ä—ã (MongoDB)</h2>
                <p style="color: #6b7280; margin: 10px 0;">
                    –°–µ—Ä–≤–∏—Å: Product Service | –ë–∞–∑–∞: MongoDB | –ì–∏–±–∫–∞—è —Å—Ö–µ–º–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤
                </p>

                <div x-show="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

                <div class="grid" x-show="!loading">
                    <template x-for="product in products" :key="product._id">
                        <div class="card">
                            <h3 x-text="product.name"></h3>
                            <p class="stat" style="font-size: 24px; margin: 10px 0;">
                                <span x-text="product.price"></span> ‚ÇΩ
                            </p>
                            <p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> <span x-text="product.category"></span></p>
                            <p><strong>–ù–∞ —Å–∫–ª–∞–¥–µ:</strong> <span x-text="product.stock"></span> —à—Ç.</p>
                            <p style="color: #6b7280; margin-top: 10px; font-size: 14px;" x-text="product.description"></p>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Orders Tab -->
            <div x-show="currentTab === 'orders'">
                <h2>üõí –ó–∞–∫–∞–∑—ã (PostgreSQL)</h2>
                <p style="color: #6b7280; margin: 10px 0;">
                    –°–µ—Ä–≤–∏—Å: Order Service | –ë–∞–∑–∞: PostgreSQL | ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
                </p>

                <div x-show="loading" class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

                <div class="grid" x-show="!loading">
                    <template x-for="order in orders" :key="order.id">
                        <div class="card">
                            <h3>–ó–∞–∫–∞–∑ #<span x-text="order.id"></span></h3>
                            <p class="stat" style="font-size: 24px; margin: 10px 0;">
                                <span x-text="order.total_amount"></span> ‚ÇΩ
                            </p>
                            <p><strong>–°—Ç–∞—Ç—É—Å:</strong> <span x-text="order.status"></span></p>
                            <p><strong>–¢–æ–≤–∞—Ä–æ–≤:</strong> <span x-text="order.items?.length || 0"></span></p>
                            <p style="font-size: 12px; color: #9ca3af; margin-top: 10px;">
                                –°–æ–∑–¥–∞–Ω: <span x-text="new Date(order.created_at).toLocaleString('ru')"></span>
                            </p>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <script>
        function app() {
            return {
                currentTab: 'overview',
                loading: false,
                health: {
                    users: false,
                    products: false,
                    orders: false
                },
                stats: {
                    users: {},
                    products: {},
                    orders: {}
                },
                users: [],
                products: [],
                orders: [],

                async init() {
                    await this.checkHealth();
                    await this.loadStats();
                    await this.loadData();
                },

                async checkHealth() {
                    try {
                        const [users, products, orders] = await Promise.all([
                            fetch('/api/health/users'),
                            fetch('/api/health/products'),
                            fetch('/api/health/orders')
                        ]);

                        this.health.users = users.ok;
                        this.health.products = products.ok;
                        this.health.orders = orders.ok;
                    } catch (e) {
                        console.error('Health check failed:', e);
                    }
                },

                async loadStats() {
                    try {
                        const [users, products, orders] = await Promise.all([
                            fetch('/api/user-stats').then(r => r.json()),
                            fetch('/api/product-stats').then(r => r.json()),
                            fetch('/api/order-stats').then(r => r.json())
                        ]);

                        this.stats.users = users;
                        this.stats.products = products;
                        this.stats.orders = orders;
                    } catch (e) {
                        console.error('Stats loading failed:', e);
                    }
                },

                async loadData() {
                    this.loading = true;
                    try {
                        const [usersResp, productsResp, ordersResp] = await Promise.all([
                            fetch('/api/users').then(r => r.json()),
                            fetch('/api/products').then(r => r.json()),
                            fetch('/api/orders').then(r => r.json())
                        ]);

                        this.users = usersResp.users || [];
                        this.products = productsResp.products || [];
                        this.orders = ordersResp.orders || [];
                    } catch (e) {
                        console.error('Data loading failed:', e);
                    } finally {
                        this.loading = false;
                    }
                }
            }
        }
    </script>
</body>
</html>
